<apex:page sidebar="false" showHeader="false" standardStylesheets="false" controller="OperationsPortalController">
    <html>
        <head>
            <apex:includeLightning />
            <c:Libraries2 ></c:Libraries2>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.6/semantic.css"/>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"/>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.8/angular.js"/>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.6/semantic.js">
                    </script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js">
            </script>
            <link href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" rel="stylesheet"/>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous"/>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <apex:stylesheet value="{!$Resource.OperationsPortalCSS}" />
            
            <style>
                .loadingBackground {
                position: fixed;
                height: 100%;
                width: 100%;
                background: #F6F6F6;
                z-index: 11111;
                opacity: 0.7;
                top: 0px;
                left: 0;
                bottom: 0;
                right: 0;
                }
                .loading {
                top: 50%;
                left: 50%;
                margin: -50px 0px 0px -50px;
                z-index: 111111;
                position: fixed;
                }
                
                .tab {
                overflow: hidden;
                border: 1px solid #ccc;
                background-color: mintcream;
                padding-left: 1%;
                margin-left: 1%;
                margin-right: 2%;
                border-radius: 11px;
                }
                
                /* Style the buttons inside the tab */
                .tab button {
                background-color: inherit;
                float: left;
                border: none;
                outline: none;
                cursor: pointer;
                padding: 14px 16px;
                transition: 0.3s;
                font-size: 17px;
                }
                
                /* Change background color of buttons on hover */
                .tab button:hover {
                background-color: #ddd;
                }
                
                /* Create an active/current tablink class */
                .tab button.active {
                background-color: #ccc;
                }
                
                /* Style the tab content */
                .tabcontent {
                display: none;
                padding: 6px 12px;
                border: 1px solid #ccc;
                border-top: none;
                }
            </style>
        </head>
        
        <body ng-app="SampleDet_App" ng-controller="SampleDet_ctrl" style="background-color: white; !important;">

            <div class="modal" id="filePreview">
                <div class="modal-dialog" style="min-width:120rem">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">
                                <div class="d-flex" style="background:unset;">
                                    <h3 style="text-align: center"><b>{{selectedFile.userDocument.Name}}</b></h3>
                                </div>
                            </h4>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <iframe style="width:100%;height:75vh;border: 0px;border-radius: 10px;" id="file_frame" title="File"></iframe>
                        </div>
                        <div class="col-md-4 cancelSaveBtnDiv">
                            <button class="blue-btn me-2 mb-5" ng-click="saveInvoiceUnderAccount()" type="button">Save</button>
                            <button class="blue-btn me-2 mb-5" data-bs-dismiss="modal" type="button">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="loadingSection" ng-if="showSpinner">
                <div class="loadingBackground"></div>
                <div>
                    <apex:image url="{!$Resource.Loading}" styleClass="loading" />
                </div>
            </div>
            
            <nav class="navbar navbar-expand-lg navbar-light">
                <div class="wrapper px-5">
                    <div>
                        <apex:image url="{!$Resource.logo}" alt="SYMEGA" styleClass="brand-logo"/>
                    </div>
                <div style="width: 50%;">
                    <!-- <marquee>
<h2 class="nav-link" style="color:white;"><b>Hello We partner with our customers across a project’s lifespan – from inception, through product commercialisation, sharing our experience and expertise. With our informed, committed, and passionate team of professionals, we strive to provide you with solutions that bring your culinary ideas to life, faster and better.</b></h2>
</marquee> -->
                </div>
                
                <div class="d-flex text-align-center">
                    <div class="dropdown">
                        <i class="far fa-user fa-2x" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false" style="color:white;">
                        </i>
                        <ul class="dropdown-menu" style="width: 300px" aria-labelledby="dropdownMenuButton1">                                                            
                            <li><a class="dropdown-item pe-5"><i class="fa-solid fa-user me-3"></i>{{contactName}}</a></li>
                            <li>
                            <hr class="dropdown-divider" />
                        </li>
                        <li><a class="dropdown-item pe-5" ng-click="showProfileDiv()"><i class="fa-solid fa-edit me-3"></i>Edit Profile</a></li>
                            <li>
                            <hr class="dropdown-divider" />
                        </li>
                        <li>
                            <a class="dropdown-item pe-5" ng-click="LogoutApplicant()"><i class="fa-solid fa-right-from-bracket me-3"></i>Logout</a>
                        </li>
                        </ul>
                        </div>
                    </div>
            </div>
        </nav>
            <apex:includeLightning />
            <div  id="container"/>
            
            <div class="row mx-5" ng-show="showDetailPage">
                <div class="row box-shadow-2 mb-5">
                    <div class="row mt-5 mx-1">
                        <div class="col-md-8">
                            <h3 class="pb-3 color-theme"><b>BASIC DETAILS</b></h3>
                        </div>
                        
                        <div class="col-md-4">
                            <div id="hideForDispatch" style="display:none;" class="buttonContainer">
                                <button class="blue-btn me-2 mb-5" ng-click="openReleaseToDispatch()" style="background:teal;" type="button">
                                    Release To Dispatch Team</button>
                        <button class="blue-btn me-2 mb-5" ng-click="openGenerateLabel()" style="background:teal;" type="button">
                            Generate Label</button>
                            <button class="blue-btn me-2 mb-5" ng-click="openGenerateNonHazardous()" style="background:teal;" type="button">
                                Generate Non-Hazardous</button>
                            <button class="blue-btn float-end me-2 mb-5" ng-click="openAuraPopUp()" style="background:teal;" type="button">
                                Create/Edit Sample Lineitems</button>
                            </div>

                            <div class="modal" id="releaseToDispatch">
                                <div class="modal-dialog" style="min-width:95%; margin-top: 30vh;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title"><div class="d-flex justify-content-center" style="background:unset;">
                                                <h3>
                                                    <b>Release To Dispatch Team</b>
                                                </h3>
                                                </div></h4> 
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row mt-3 mx-5" style="margin: 0px!important;">
                                                <div class="col-md-12" style="overflow-x:auto;">
                                                    
                                                    <table class="table" style="width:150%">
                                                        <thead>
                                                            <tr>
                                                                <th style="width:0%;">S.No.</th>
                                                                <th style="width:2%;">Product</th>
                                                                <th style="width:0%;">Sample Invoice Date</th>
                                                                <th style="width:0%;">Actual Date of Dispatch</th>
                                                                <th style="width:5%;">Courier</th>
                                                                <th style="width:5%;">Dispatch Details</th>
                                                                <th style="width:5%;">Way Bill No.</th>
                                                                <th style="width:5%;">Additional Comments</th>
                                                                <th style="width:5%;">Release Status</th>
                                                                <!--th style="width:10%;">Customer Instructions</th>
                                                                <th style="width:1%"><i class="fas fa-plus-circle icon ps-3" ng-click="addRow()"></i></th-->
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr ng-repeat="SLI in SLIlist">
                                                                <!--{{SLIlist}}-->
                                                                <td>{{$index+1}}</td>
                                                                <td>{{SLI.Name}}</td>
                                                                <td><input class="form-control" type="Date" ng-model="SLI.Sample_Invoice_Date__c" ng-disabled="SLI.checkReleaseStatus"/></td>
                                                                <td><input type="Date" class="form-control" ng-model="SLI.Actual_date_of_dispatch__c" ng-disabled="SLI.checkReleaseStatus"/></td>
                                                                <td><input type="text" class="form-control" ng-model="SLI.Courier__c" ng-disabled="SLI.checkReleaseStatus" /></td>
                                                                <td><input type="text" class="form-control" ng-model="SLI.Dispatch_Details__c" ng-disabled="SLI.checkReleaseStatus" /></td>
                                                                <td><input type="text" class="form-control" ng-model="SLI.Way_Bill_No__c" ng-disabled="SLI.checkReleaseStatus" /></td> 
                                                                <td><input type="text" class="form-control" ng-model="SLI.Additional_Comments__c" ng-disabled="SLI.checkReleaseStatus" /></td>
                                                                <td><div class="col-md-4 pt-3" ng-repeat="status in releaseStatus">
                                                                    <input type="radio" ng-model="SLI.Release_Status__c" ng-value="status" ng-change="ChangeOfReleaseStatus(status, SLI)" />
                                                                    <label>{{status}}</label>
                                                                </div></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div> 
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6 mb-5">
                                                <button type="button" ng-click="saveSLIList()" class="blue-btn float-end">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                                <div class="modal" id="genrateLabelModal">
                                    <div class="modal-dialog" style="min-width:95%; margin-top: 10vh;">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title"><div class="d-flex justify-content-center" style="background:unset;">
                                                    <h3>
                                                        <b>Sample Invoice</b>
                                                    </h3>
                                                    </div></h4> 
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row mt-3 mx-5" style="margin: 0px!important;">
                                                    <div class="col-md-12" style="overflow-x:auto;">
                                                        <iframe height="400px" width="100%;" src="{{URLused}}" scrolling="true"></iframe>
                                                    </div> 
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6 mb-5">
                                                    <button type="button" ng-click="saveLabel()" class="blue-btn float-end">Save</button>
                                                </div>
                                                <div class="col-md-6 mb-5">
                                                    <button type="button" data-bs-dismiss="modal" class="blue-btn">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal" id="genrateNonHazardousModal">
                                    <div class="modal-dialog" style="min-width:95%; margin-top: 10vh;">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title"><div class="d-flex justify-content-center" style="background:unset;">
                                                    <h3>
                                                        <b>Sample Invoice</b>
                                                    </h3>
                                                    </div></h4> 
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row mt-3 mx-5" style="margin: 0px!important;">
                                                    <div class="col-md-12" style="overflow-x:auto;">
                                                        <iframe height="400px" width="100%;" src="{{URLusedForNonHazardous}}" scrolling="true"></iframe>
                                                    </div> 
                                                </div>
                                            </div>
                                            <div class="row mt-3">
                                                <div class="col-md-6 mb-5">
                                                    <button type="button" ng-click="saveNonHazardous()" class="blue-btn float-end">Save</button>
                                                </div>
                                                <div class="col-md-6 mb-5">
                                                    <button type="button" data-bs-dismiss="modal" class="blue-btn">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            <div class="modal" id="flipFlop">
                                <div class="modal-dialog" style="min-width:95%; margin-top: 30vh;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title"><div class="d-flex justify-content-center" style="background:unset;">
                                                <h3>
                                                    <b>Create Sample Line Items :</b>
                                                </h3>
                                                </div></h4> 
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row mt-3 mx-5" style="margin: 0px!important;">
                                                <div class="col-md-12" style="overflow-x:auto;">
                                                    
                                                    <table class="table" style="width:150%">
                                                        <thead>
                                                            <tr>
                                                                <th style="width:0%;">S.No.</th>
                                                                <th style="width:10%;">Product</th>
                                                                <th style="width:0%;">Quantity</th>
                                                                <th style="width:0%;">Quantity Unit</th>
                                                                <th style="width:0%;">Packaging Quantity</th>
                                                                <th style="width:2%;">Packaging Unit</th>
                                                                <th style="width:10%;">Regulatory Requirements</th>
                                                                <th style="width:10%;">Current Shelf Life</th>
                                                                <th style="width:10%;">Expected Shelf Life</th>
                                                                <th style="width:10%;">Customer Instructions</th>
                                                                <th style="width:1%"><i class="fas fa-plus-circle icon ps-3" ng-click="addRow()"></i></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr ng-repeat="SLI in SLIlist">
                                                                <!--{{SLIlist}}-->
                                                                <td>{{$index+1}}</td>
                                                                <td ng-if="SLI.check == false"><!--so-dropdown ng-model="SLI.productId" dropdown-items="mergedList" ng-change="onChangeToAssignProduct(SLI,SLI.productId.Id)" ng-disabled="SLI.check">
                                                                    <option value='None'>None</option>
                                                                    </so-dropdown-->
                                                                <select class="form-control" ng-model="SLI.ProductNm" ng-change="onChangeToAssignProduct(SLI,SLI.ProductNm)" ng-disabled="SLI.check">
                                                                    <option ng-repeat="item in mergedList" value="{{item.Name}}">{{item.Name}}</option>
                                                                    </select>
                                                                </td>
                                                                <td ng-if="SLI.check == true"><input class="form-control" type="text" ng-model="SLI.Product_Name__c" ng-disabled="SLI.check"/></td>
                                                                <td><input type="text" class="form-control" number="SLI.Quantity__c" ng-model="SLI.Quantity__c" ng-change="calculatePUnit(SLI.Quantity__c,SLI.Packaging_Quantity__c,SLI)" ng-disabled="SLI.check"/></td>
                                                                <td><select class="form-control" ng-model="SLI.Quantity_Unit__c" ng-change="setPackagingUnit(SLI.Quantity_Unit__c,SLI)" ng-disabled="SLI.check">
                                                                    <option ng-repeat="item in quantityUnit" value="{{item}}">{{item}}</option>
                                                                    </select></td>
                                                                <td><input type="text" class="form-control" number="SLI.Packaging_Quantity__c" ng-model="SLI.Packaging_Quantity__c" ng-change="calculatePUnit(SLI.Quantity__c,SLI.Packaging_Quantity__c,SLI)" ng-disabled="SLI.check" /></td>
                                                                <td>{{SLI.calc}}&nbsp;{{SLI.Packaging_Unit__c}}</td> 
                                                                <td>{{SLI.OPTIVA_Recipe__r.Regulatory__c}}</td>
                                                                <td>{{SLI. OPTIVA_Recipe__r.Shelf_Life__c}}</td>
                                                                <td>{{SLI.Expected_Shelf_Life__c}}</td>
                                                                <td><input type="text" class="form-control" ng-model="SLI.Customer_Instructions__c" ng-disabled="SLI.check" /></td>
                                                                <td ng-if="SLI.Id == undefined"><i class="fas fa-times-circle icon ps-3" ng-click="removeSALI($index)"></i></td>
                                                                <!--td ng-if="(conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c) || SLI.Id == undefined"><so-dropdown ng-model="productId" dropdown-items="mergedList" ng-change="onChangeToAssignProduct(SLI,productId)">
                                                                    <option value='None'>None</option>
                                                                    </so-dropdown></td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Project_Quotient__c != undefined">{{SLI.Project_Quotient__r.Name}}</td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Product__c != undefined">{{SLI.Product__r.Name}}</td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.OPTIVA_Recipe__c != undefined">{{SLI.OPTIVA_Recipe__r.Name}}</td>
                                                                
                                                                
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined"><input type="text" class="form-control" number="SLI.Quantity__c" ng-model="SLI.Quantity__c" ng-change="calculatePUnit(SLI.Quantity__c,SLI.Packaging_Quantity__c,SLI)"/></td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Id != undefined">{{SLI.Quantity__c}}</td>
                                                                
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined"><select class="form-control" ng-model="SLI.Quantity_Unit__c" ng-change="setPackagingUnit(SLI.Quantity_Unit__c,SLI)">
                                                                    <option ng-repeat="item in quantityUnit" value="{{item}}">{{item}}</option>
                                                                    </select></td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Id != undefined">{{SLI.Quantity_Unit__c}}</td>
                                                                
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined"><input type="text" class="form-control" number="SLI.Packaging_Quantity__c" ng-model="SLI.Packaging_Quantity__c" ng-change="calculatePUnit(SLI.Quantity__c,SLI.Packaging_Quantity__c,SLI)" /></td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Id != undefined">{{SLI.Packaging_Quantity__c}}</td>
                                                                
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c || conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined">{{SLI.calc}}&nbsp;{{SLI.Packaging_Unit__c}}</td> 
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c || conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined">{{SLI.OPTIVA_Recipe__r.Regulatory__c}}</td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c || conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined">{{SLI. OPTIVA_Recipe__r.Shelf_Life__c}}</td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined"><input type="text" class="form-control" ng-model="SLI.Expected_Shelf_Life__c" /></td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Id != undefined">{{SLI.Expected_Shelf_Life__c}}</td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c == SLI.Product_Family__c || SLI.Id == undefined"><input type="text" class="form-control" ng-model="SLI.Customer_Instructions__c" /></td>
                                                                <td ng-if="conRec.Sample_Assignment_Team__r.Team_Type__c != SLI.Product_Family__c && SLI.Id != undefined">{{SLI.Customer_Instructions__c}}</td-->
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div> 
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6 mb-5">
                                                <button type="button" ng-click="saveSLIDetails()" class="blue-btn float-end">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Sample Name
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <input class="form-control" type="text" ng-model="sampleDetails.Name" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Opportunity
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Opportunity__r.Name" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Status
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Status__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Customer Name
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <input class="form-control" type="text" ng-model="sampleDetails.Customer_Name__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Opportunity Close Date
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <input class="form-control" type="date" ng-model="sampleDetails.Opportunity_Close_Date__c" ng-disabled="false"/>
                    </div>
                   <!-- <div class="col-md-6 mt-3">
                        <label class="font-if">Business Potential Value
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Business_potential_value_INR__c" ng-disabled="true"/>
                    </div> -->
                   <!-- <div class="col-md-6 mt-3">
                        <label class="font-if">Account
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Account__r.Name" ng-disabled="true"/>
                    </div> -->
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Revert Date Count
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Revert_Date_Count__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Sub Retry Count
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Sample_Sub_Retry_Count__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Currency
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.CurrencyIsoCode" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Business potential value (INR) New
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Business_potential_value_INR_New__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Error Message On Submitting To Optiva
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Error_Message_On_Submitting_To_Optiva__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Annual Volume (in units)
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                       <!-- <select class="form-control" ng-model="sampleDetails.Annual_Volume_in_units__c">
                            <option ng-repeat="item in annulaVolInUnits" value="{{item}}">{{item}}</option>
                        </select> -->
                        <input class="form-control" type="text" ng-model="sampleDetails.Annual_Volume_in_units__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Submitted Date
                        </label>
                        <input class="form-control" type="date" ng-model="sampleDetails.Sample_Submitted_Date__c" ng-disabled="true"/>
                   <!-- <input class="form-control" type="date" ng-model="sampleDetails.Opportunity_Close_Date__c" ng-disabled="false"/> -->
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Record Type Name
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Record_Type_Name__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Sample Revert Date
                        </label>
                        <input class="form-control" type="date" ng-model="sampleDetails.Sample_Revert_Date__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Sample Delivery Date
                        </label>
                        <input class="form-control" type="date" ng-model="sampleDetails.Sample_Delivery_Date__c" ng-disabled="true"/>
                    </div>
                    
                     <div class="col-md-6 mt-3">
                        <label class="font-if">Target Price/KG
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Target_Price__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Submit To Optiva
                        </label>
                        <input class="form-check-input" type="checkbox" ng-model="sampleDetails.Submit_Sample_To_Optiva__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Submitted
                        </label>
                        <input class="form-check-input" type="checkbox" ng-model="sampleDetails.Submitted_To_SAP_Optiva__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Error Occured On Submitting To Optiva
                        </label>
                        <input class="form-check-input" type="checkbox" ng-model="sampleDetails.Error_Occured_On_Submitting_To_Optiva__c" ng-disabled="true"/>
                    </div>

                    
                    <div class="row mt-5 mx-1">
                        <div class="col-md-12">
                            <h3 class="pb-3 color-theme"><b>SAMPLING BRIEF</b></h3>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Product ID
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Product_ID__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">End Use Category
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <select class="form-control" ng-model="sampleDetails.End_Use_category__c">
                            <option ng-repeat="item in endUseCategory" value="{{item}}">{{item}}</option>
                        </select>
                        <!--input class="form-control" type="text" ng-model="sampleDetails.End_Use_category__c" ng-disabled="false"/-->
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Expected Annual Value
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Expected_Annual_Value__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">End Use Applications
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <input class="form-control" type="text" ng-model="sampleDetails.End_Use_Applications__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Minimum order quantity
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Minimum_order_quantity__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Minimum order Unit
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Minimum_order_quantity_unit__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">First Sample due date
                        </label>
                        <input class="form-control" type="date" ng-model="sampleDetails.First_Sample_due_date__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Product Instruction
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Product_Instruction__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Dosage Guidelines
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Dosage_Guidelines__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Product Family
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Product_Family__c" ng-disabled="true"/>
                    </div>
                    
                    <div class="row mt-5 mx-1">
                        <div class="col-md-12">
                            <h3 class="pb-3 color-theme"><b>TELL US MORE</b></h3>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Sample Requested by
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <select class="form-control" ng-model="sampleDetails.Sample_Requested_by__c">
                            <option ng-repeat="item in sampleReqBy" value="{{item}}">{{item}}</option>
                        </select>
                        <!--input class="form-control" type="text" ng-model="sampleDetails.Sample_Requested_by__c" ng-disabled="false"/-->
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Main reason for selecting product
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <select class="form-control" ng-model="sampleDetails.Main_reason_for_selecting_product__c">
                            <option ng-repeat="item in mainReasonForSelPro" value="{{item}}">{{item}}</option>
                        </select>
                        <!--input class="form-control" type="text" ng-model="sampleDetails.Main_reason_for_selecting_product__c" ng-disabled="false"/-->
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Specify other reason
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Specify_other_reason__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Annual Volume - Full
                        </label>
                        
                        <input class="form-control" type="text" ng-model="sampleDetails.Annual_Volume_Full__c" ng-disabled="false"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Expected Volume Unit
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Expected_Volume_Unit__c" ng-disabled="true"/>
                    </div>
                    
                    <div class="row mt-5 mx-1">
                        <div class="col-md-12">
                            <h3 class="pb-3 color-theme"><b>SHIPPING ADDRESS INFORMATION</b></h3>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Company Name
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Company_Name__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Contact Name
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Customers_Contact__r.Name" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Contact Number
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Contact_Number__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">City
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.City__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">State
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.State__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Country
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Country__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3">
                        <label class="font-if">Street
                        </label>
                        <span class="required-asterisk" style="color:red;">*</span>
                        <input class="form-control" type="text" ng-model="sampleDetails.Street__c" ng-disabled="true"/>
                    </div>
                    <div class="col-md-6 mt-3 mb-3">
                        <label class="font-if">Postal Code
                        </label>
                        <input class="form-control" type="text" ng-model="sampleDetails.Postal_Code__c" ng-disabled="true"/>
                    </div>
                    
                </div>
            </div>
            
            <div class="col-md-6 mt-3 mb-3" ng-show="showbackAndSaveBtn">
                <button class="blue-btn float-end me-2 mb-5" ng-click="SaveSampleDetails()" type="button">
                    Save</button>
                <button class="blue-btn float-end me-2 mb-5" ng-click="back()" type="button">
                    <i class="fa-solid fa-arrow-left me-2"></i>Back</button>
            </div>

            <div class="row box-shadow-2" ng-show="showProfile" style="margin-top:10rem!important;margin-right:24rem!important;margin-left:24rem!important;">
                <div class="row mt-5 mx-1">
                    <div class="col-md-12">
                        <h3 class="pb-3 color-theme"><b>EDIT PROFILE</b></h3>
                    </div>
                </div>
                <div class="col-md-6 mt-3">
                    <label class="font-if">First Name
                    </label>
                    <input class="form-control" type="text" ng-model="conRec.FirstName" ng-disabled="true"/>
                </div>
                <div class="col-md-6 mt-3">
                    <label class="font-if">Last Name
                    </label>
                    <input class="form-control" type="text" ng-model="conRec.LastName" ng-disabled="true"/>
                </div>
                <div class="col-md-6 mt-3">
                    <label class="font-if">Email
                    </label>
                    <input class="form-control" type="text" ng-model="conRec.Email" ng-disabled="true"/>
                </div>
                <div class="col-md-6 mt-3">
                    <label class="font-if">Phone
                    </label>
                    <input class="form-control" type="text" ng-model="conRec.MobilePhone"/>
                </div>
                <div class="col-md-6 mt-3 mb-5">
                    <label class="font-if">Password
                    </label>
                    <input class="form-control" type="password" ng-model="conRec.Password__c"/>
                </div>
                <div class="col-md-6 mt-3 mb-5" id="updateCancelBtn">
                    <button class="blue-btn float-end" ng-click="saveDetails()" type="button">
                        <i class="fa-solid fa-check me-2"></i>Update</button>
                    <button class="blue-bordered-btn float-end me-2" ng-click="backProfile()" type="button">
                        <i class="fa-solid fa-arrow-left me-2"></i>Cancel</button>
                </div>
            </div>
        </body>
        
        <script>
        var userHashId = '{!$CurrentPage.parameters.id}';
        var sampleId = '{!$CurrentPage.parameters.sampleId}';
        var quantityUnit = JSON.parse('{!quantityUnit}');
        var releaseStatus = JSON.parse('{!releaseStatus}');
        var endUseCategory = JSON.parse('{!endUseCategory}');
        var sampleReqBy = JSON.parse('{!sampleReqBy}');
        var mainReasonForSelPro = JSON.parse('{!mainReasonForSelPro}');
        var annulaVolInUnits = JSON.parse('{!annulaVolInUnits}');
        var parentId = '0061m00000AyM4bAAF';
        
        angular.module('number', [])
        .directive('number', function () {
            return {
                require: 'ngModel',
                restrict: 'A',
                link: function (scope, element, attrs, ctrl) {
                    ctrl.$parsers.push(function (input) {
                        if (input == undefined) return ''
                        var inputNumber = input.toString().replace(/[^0-9]/g, '');
                        if (inputNumber != input) {
                            ctrl.$setViewValue(inputNumber);
                            ctrl.$render();
                        }
                        return inputNumber;
                    });
                }
            };
        });
        
        angular.module('decimal', [])
        .directive('decimal', function () {
            return {
                require: 'ngModel',
                restrict: 'A',
                link: function (scope, element, attrs, ctrl) {
                    ctrl.$parsers.push(function (input) {
                        if (input == undefined) return ''
                        var inputNumber = input.toString().replace(/[^0-9/.]/g, '');
                        if (inputNumber != input) {
                            ctrl.$setViewValue(inputNumber);
                            ctrl.$render();
                        }
                        return inputNumber;
                    });
                }
            };
        });
        var app = angular.module('SampleDet_App', []);
        app.controller('SampleDet_ctrl', function ($scope,$sce){
            debugger;
           // $scope.challanLink = {!JSENCODE($Label.SymegaWaterMarkLink)};
           $scope.challanLink = 'https://symegafood--uat--c.sandbox.vf.force.com/apex/SymegaStickerPDF?id=';
           $scope.challanLinkForNonHazardous = 'https://symegafood--uat--c.sandbox.vf.force.com/apex/NonHarzardousDHLPDF?id=';
            $scope.quantityUnit = quantityUnit;
            $scope.endUseCategory = endUseCategory;
            $scope.sampleReqBy = sampleReqBy;
            $scope.mainReasonForSelPro = mainReasonForSelPro;
            $scope.annulaVolInUnits = annulaVolInUnits;
            $scope.teamTypeList = [];
            $scope.showProfile = false;
            $scope.showDetailPage=true;
            $scope.showbackAndSaveBtn=true;
            $scope.releaseStatus = releaseStatus;
            
            $scope.getSampleDetails = function(){
                debugger;
                $scope.mergedList = [{Id:'--None--', Name:'--None--'}];
                //productId = {Id:'', Name:''};
                OperationsPortalController.getSampleDetails(sampleId,userHashId,function(result,event){
                    debugger;
                    if(event.status && result){
                        debugger;
                        $scope.conRec = result.conRec;
                        if($scope.conRec.Role__c != 'Dispatch Team'){
                            $('#hideForDispatchu').show();
                        }
                        $scope.sampleDetails = result.listOfSamples[0];
                        $scope.sampleId = $scope.sampleDetails.Id;
                        $scope.URLused = $sce.trustAsResourceUrl($scope.challanLink + $scope.sampleId);
                        $scope.urlToSendToApex = $scope.challanLink + $scope.sampleId;
                        $scope.URLusedForNonHazardous = $sce.trustAsResourceUrl($scope.challanLinkForNonHazardous + $scope.sampleId);
                        $scope.urlToSendToApexForNonHazardous = $scope.challanLink + $scope.sampleId;
                        $scope.allocationTeam = result.conRec.Account__r;
                        if(result.listOfSamples[0].Opportunity_Close_Date__c != null){
                            $scope.sampleDetails.Opportunity_Close_Date__c = new Date(result.listOfSamples[0].Opportunity_Close_Date__c);
                        }
                        if(result.listOfSamples[0].Sample_Submitted_Date__c != null){
                            $scope.sampleDetails.Sample_Submitted_Date__c = new Date(result.listOfSamples[0].Sample_Submitted_Date__c); 
                        }
                        if(result.listOfSamples[0].Sample_Revert_Date__c != null){
                            $scope.sampleDetails.Sample_Revert_Date__c = new Date(result.listOfSamples[0].Sample_Revert_Date__c); 
                        } 
                         if(result.listOfSamples[0].Sample_Delivery_Date__c != null){
                            $scope.sampleDetails.Sample_Delivery_Date__c = new Date(result.listOfSamples[0].Sample_Delivery_Date__c); 
                        } 
                        if(result.listOfSamples[0].First_Sample_due_date__c != null){
                            $scope.sampleDetails.First_Sample_due_date__c = new Date(result.listOfSamples[0].First_Sample_due_date__c); 
                        }
                        $scope.contactName = result.conRec.Name;
                        $scope.accId = result.
                        accId;
                        if(result.listOfSamples[0].Sample_Line_Items__r != undefined){
                            debugger;
                            $scope.SLIlist = result.listOfSamples[0].Sample_Line_Items__r;
                            debugger;
                            $scope.SLIlistOld = result.listOfSamples[0].Sample_Line_Items__r;
                            for(var i=0;i<$scope.SLIlist.length;i++){
                                $scope.SLIlist[i].calc = $scope.SLIlist[i].Formula_Packaging_Qty__c;
                                //$scope.SLIlist[i].calc = $scope.SLIlist[i].Quantity__c/$scope.SLIlist[i].Packaging_Quantity__c;
                                 		if($scope.SLIlist[i].Product__c != undefined){
                                     		$scope.SLIlist[i].ProductNm = $scope.SLIlist[i].Product__r.Name;
                                            $scope.SLIlist[i].productId = $scope.SLIlist[i].Product__c;
                                        }else if($scope.SLIlist[i].OPTIVA_Recipe__c != undefined){
                                            $scope.SLIlist[i].ProductNm = $scope.SLIlist[i].OPTIVA_Recipe__r.Name;
                                            $scope.SLIlist[i].productId = $scope.SLIlist[i].OPTIVA_Recipe__c;
                                        }else if($scope.SLIlist[i].Project_Quotient__c != undefined){
                                            $scope.SLIlist[i].ProductNm = $scope.SLIlist[i].Project_Quotient__r.Name;
                                            $scope.SLIlist[i].productId = $scope.SLIlist[i].Project_Quotient__c;
                                        }else{
                                            $scope.SLIlist[i].productId = "--None--";
                                        }
                                        if($scope.SLIlist[i].Release_Status__c != 'Released' || $scope.SLIlist[i].Release_to_Dispatch_Team__c == false){
                                            $scope.SLIlist[i].checkReleaseStatus = true;
                                        }
                                        if($scope.SLIlist[i].Actual_date_of_dispatch__c != null){
                                            $scope.SLIlist[i].Actual_date_of_dispatch__c = new Date($scope.SLIlist[i].Actual_date_of_dispatch__c);
                                }
                                if($scope.SLIlist[i].Sample_Invoice_Date__c != null){
                                    $scope.SLIlist[i].Sample_Invoice_Date__c = new Date($scope.SLIlist[i].Sample_Invoice_Date__c);
                                }
                            }
                        }else{
                            $scope.SLIlist = [];
                            $scope.SLIlist.push({
                                "Quantity__c":"","Quantity_Unit__c":"","Packaging_Quantity__c":"","Packaging_Unit__c":"","Sample__c":sampleId,"Packaging_Unit__c":"","OPTIVA_Recipe__r.Regulatory__c":"","OPTIVA_Recipe__r.Shelf_Life__c":"","Expected_Shelf_Life__c":"","Customer_Instructions__c":""
                            })
                        }
                        
                        $scope.productList = result.listOfProducts;
                        $scope.optivaRecipeList = result.listOfOptivaRecipe;
                        $scope.projectQuotientList = result.listOfProQuotient;
                        
                        for(var i=0;i<$scope.productList.length;i++){
                            $scope.mergedList.push({"Id":$scope.productList[i].Id,"Name":$scope.productList[i].Name});
                        }
                        for(var i=0;i<$scope.optivaRecipeList.length;i++){
                            $scope.mergedList.push({"Id":$scope.optivaRecipeList[i].Id,"Name":$scope.optivaRecipeList[i].Name});
                        }
                        for(var i=0;i<$scope.projectQuotientList.length;i++){
                            $scope.mergedList.push({"Id":$scope.projectQuotientList[i].Id,"Name":$scope.projectQuotientList[i].Name});
                        }
                        if($scope.allocationTeam != undefined){
                            for(var i=0;i<$scope.allocationTeam.length;i++){
                                $scope.teamTypeList.push($scope.allocationTeam[i].Sample_Assignment_Team_Type__c);
                            }
                        }
                        for(var i=0;i<$scope.SLIlist.length;i++){
                            if($scope.teamTypeList.includes($scope.SLIlist[i].Product_Family__c)){
                               	$scope.SLIlist[i].check = false;
                            }else{
                               $scope.SLIlist[i].check = true;
                               }
                        }
                        //$scope.mergedList = [].concat($scope.productList, $scope.optivaRecipeList, $scope.projectQuotientList);
                        $scope.$apply();
                    }
                })
            }
            $scope.getSampleDetails();

            $scope.ChangeOfReleaseStatus = function(value, SLIRec){
                    debugger;
                    //$scope.SLIRec.Release_Status__c = value;
                    if(value == 'Released'){
                        SLIRec.checkReleaseStatus = false;
                        SLIRec.Release_to_Dispatch_Team__c = true;
                    }else{
                        SLIRec.checkReleaseStatus = true;
                        SLIRec.Release_to_Dispatch_Team__c = false;
                    }
                }

                $scope.saveSLIList = function(){
                    debugger;
                    for(var i=-0; i<$scope.SLIlist.length; i++){
                        delete ($scope.SLIlist[i]['$$hashKey']);
                        delete ($scope.SLIlist[i]['checkReleaseStatus']);
                        delete ($scope.SLIlist[i]['calc']);
                        delete ($scope.SLIlist[i]['check']);
                        delete ($scope.SLIlist[i]['productId']);
                        delete ($scope.SLIlist[i]['ProductNm']);
                        if($scope.SLIlist[i].Actual_date_of_dispatch__c != null){
                            const dateString = $scope.SLIlist[i].Actual_date_of_dispatch__c;
                    const epochTimestamp = new Date(dateString).getTime() / 1000;
                    $scope.SLIlist[i].Actual_date_of_dispatch__c = epochTimestamp;
                        }
                        if($scope.SLIlist[i].Sample_Invoice_Date__c != null){
                            const dateString = $scope.SLIlist[i].Sample_Invoice_Date__c;
                    const epochTimestamp = new Date(dateString).getTime() / 1000;
                    $scope.SLIlist[i].Sample_Invoice_Date__c = epochTimestamp;
                        }
                    }
                        OperationsPortalController.updateSLIList($scope.SLIlist,function(result,event){
                            debugger;
                            if(event.status && result){
                                swal("success", "Records has been updated successfully.","success");
                                $scope.$apply();
                            }
                        })
                }

            $scope.showProfileDiv=function(){
                debugger;
                $scope.showDetailPage=false;
                $scope.showbackAndSaveBtn=false;
                $scope.showProfile = true;
            }

            $scope.backProfile = function(){
                debugger;
                //$scope.showListViewOfSLI=true;
                //$scope.showDetailPageSLI=false;

                $scope.showProfile = false;
                $scope.showDetailPage=true;
                $scope.showbackAndSaveBtn=true;
            }

            $scope.saveDetails = function(){
                debugger;
                delete($scope.conRec['Account__r']);
                $scope.showSpinner = true;
                OperationsPortalController.updateProfile($scope.conRec,function(result,event){
                    debugger;
                    if(event.status && result){
                        $scope.showSpinner = false;
                        swal("success", "Your profile has been updated.","success");
                        $scope.backProfile();
                        $scope.$apply();
                    }
                })
            }

            $scope.LogoutApplicant=function(){  
                $scope.showSpinner = true;      
                OperationsPortalController.LogoutApplicant(userHashId, function (result, event) {
                debugger
                console.log(result);
                console.log(event);
                if(event.status){
                    $scope.res=result;
                    $scope.redirect();
                    $scope.$apply();
                }
        });   
            }

            $scope.redirect = function(){
                debugger;
                var sitePrefix = window.location.href.includes('/apex') ? '/apex' : '/operations';
                setTimeout(function() {window.location.replace(window.location.origin + sitePrefix )}, 3000);
            }

//             $scope.filePreviewHandler = function(fileContent){
// debugger;
// $scope.selectedFile = fileContent;

// console.log('selectedFile---', $scope.selectedFile);

// $('#file_frame').attr('src', $scope.selectedFile[0].DistributionPublicUrl);

// var myModal = new bootstrap.Modal(document.getElementById('filePreview'))        
// myModal.show('slow') ;
// $scope.$apply();

// //.ContentDistribution.DistributionPublicUrl
// }

$scope.saveLabel = function(){
                debugger;
                OperationsPortalController.savePDF($scope.urlToSendToApex, $scope.sampleId, 'Sample Invoice', function(result, event){
                    $scope.showSpinner = true;
                    if(event.status && result){
                        $scope.labelToDisplay = result;
                            //$scope.contentVersionId = result[0].ContentVersionId;
                            $scope.showSpinner = false;
                            swal("success", "Label has been successfully saved!","success");
                            $('#genrateLabelModal').modal('toggle');
                            $scope.$apply();
                            //$scope.filePreviewHandler(result);
                    }else{
                        swal("error", "Label wasn't saved due to an error!","error");
                        $scope.showSpinner = false;
                            $('#genrateLabelModal').modal('toggle');
                            $scope.$apply();
                    }
                });
            }

            $scope.saveNonHazardous = function(){
                debugger;
                OperationsPortalController.savePDF($scope.urlToSendToApexForNonHazardous, $scope.sampleId, 'Sample Invoice', function(result, event){
                    $scope.showSpinner = true;
                    if(event.status && result){
                        $scope.labelToDisplay = result;
                            //$scope.contentVersionId = result[0].ContentVersionId;
                            $scope.showSpinner = false;
                            swal("success", "Label has been successfully saved!","success");
                            $('#genrateNonHazardousModal').modal('toggle');
                            $scope.$apply();
                            //$scope.filePreviewHandler(result);
                    }else{
                        swal("error", "Label wasn't saved due to an error!","error");
                        $scope.showSpinner = false;
                            $('#genrateNonHazardousModal').modal('toggle');
                            $scope.$apply();
                    }
                });
            }
            
            $scope.back = function(){
                debugger;
                var sitePrefix = '/operations/CustomerDetailPageOP';
                window.location.replace(window.location.origin + sitePrefix +'?id='+ userHashId + '&accId=' + $scope.accId);
            }
            
            $scope.openAuraPopUp = function(){
                debugger;
                var myModal = new bootstrap.Modal(document.getElementById('flipFlop'));
                myModal.show('slow');
            }

            $scope.openReleaseToDispatch = function(){
                debugger;
                $scope.showSpinner = true;
                var myModal = new bootstrap.Modal(document.getElementById('releaseToDispatch'));
                myModal.show('slow');
                $scope.showSpinner = false;
            }

            $scope.openGenerateLabel = function(){
                debugger;
                $scope.showSpinner = true;
                var myModal = new bootstrap.Modal(document.getElementById('genrateLabelModal'));
                myModal.show('slow');
                $scope.showSpinner = false;
            }

            $scope.openGenerateNonHazardous = function(){
                debugger;
                $scope.showSpinner = true;
                var myModal = new bootstrap.Modal(document.getElementById('genrateNonHazardousModal'));
                myModal.show('slow');
                $scope.showSpinner = false;
            }
            
            $scope.myFunc = function() {
                debugger;
                alert('hi there...!');
                
                // Use the LWC Open Source JavaScript library
                // Assuming your LWC is LightningOut enabled
                $Lightning.use("c:submitForFertCodeApp", function() {
                    const container = document.getElementById("compContainer");
                    
                    // Create a new Lightning Web Component
                    const lwcElement = document.createElement("c-submit-for-fert-code");
                    lwcElement.recordId = parentid;
                    
                    // Append the component to the container
                    container.appendChild(lwcElement);
                });
            };
            
            $scope.onChangeToAssignProduct = function(SLI,productId){
                console.log(SLI);
                debugger;
                var foundItem = $scope.mergedList.find(item => item.Name === productId);
                if (foundItem) {
                    if (foundItem.Id.startsWith('01t')) {
                        SLI.Product__c = foundItem.Id;
                    }else if(foundItem.Id.startsWith('a0S')){
                        SLI.Project_Quotient__c = foundItem.Id;
                        //$scope.productId = SLI.Project_Quotient__r.Name;
                    }else if(foundItem.Id.startsWith('a0Y')){
                        SLI.OPTIVA_Recipe__c = foundItem.Id;
                        //$scope.productId = SLI.OPTIVA_Recipe__r.Name;
                    }else{
                    }
                }
            }
            
            $scope.saveSLIDetails = function(){
                debugger;
                for(var i=0;i<$scope.SLIlist.length;i++){
                    debugger;
                    if($scope.SLIlist[i].Product__c == undefined && $scope.SLIlist[i].OPTIVA_Recipe__c == undefined && $scope.SLIlist[i].Project_Quotient__c == undefined){
                        swal("info", "Please add Product.","info");
                        return;
                    }
                    if($scope.SLIlist[i].Quantity__c == undefined || $scope.SLIlist[i].Quantity__c == ""){
                        swal("info", "Please enter quantity.","info");
                        return;
                    }
                    if($scope.SLIlist[i].Quantity_Unit__c == undefined || $scope.SLIlist[i].Quantity_Unit__c == ""){
                        swal("info", "Please enter quantity unit.","info");
                        return;
                    }
                    if($scope.SLIlist[i].Packaging_Quantity__c == undefined || $scope.SLIlist[i].Packaging_Quantity__c == ""){
                        swal("info", "Please enter packaging quantity.","info");
                        return;
                    }
                }
                
                for(var i=0;i<$scope.SLIlist.length;i++){
                    delete ($scope.SLIlist[i]['$$hashKey']);
                    delete ($scope.SLIlist[i]['calc']);
                    delete ($scope.SLIlist[i]['check']);
                    delete ($scope.SLIlist[i]['productId']);
                    delete ($scope.SLIlist[i]['ProductNm']);
                    delete ($scope.SLIlist[i]['Actual_date_of_dispatch__c']);
                    delete ($scope.SLIlist[i]['Sample_Invoice_Date__c']);
                    delete ($scope.SLIlist[i]['checkReleaseStatus']);
                }
                OperationsPortalController.saveSLIDetails($scope.SLIlist,userHashId,function(result,event){
                    debugger;
                    if(event.status && result){
                        debugger;
                        swal("success", "Record has been update successfully.","success");
                        $('#flipFlop').modal('toggle');
                    }
                    $scope.$apply();
                    $scope.getSampleDetails();
                })
            }
            
            $scope.addRow=function(){
                debugger;
                $scope.SLIlist.push({
                    "Quantity_Unit__c":"","Packaging_Quantity__c":"","Packaging_Unit__c":"","Sample__c":sampleId,"check":false
                });
            }
            
            $scope.calculatePUnit = function(quantity,pquantity,SLI){
                debugger;
                if(pquantity != 0 && pquantity != null && pquantity != undefined){
                    SLI.calc = quantity/pquantity;
                }else{
                    SLI.calc = '';
                }
            }
            
            $scope.setPackagingUnit = function(qUnit,SLI){
                debugger;
                SLI.Packaging_Unit__c = SLI.Quantity_Unit__c;
                
            }
            
            $scope.removeSALI = function(index){
                debugger;
                if ($scope.SLIlist.length == 1) {
                    return;
                }
                if($scope.SLIlist[index].Id == undefined){
                    $scope.SLIlist.splice(index, 1);
                    return;
                }
            }
            
            $scope.SaveSampleDetails = function(){
                debugger;
                var year=0;
                var month=0;
                var day=0;
                if($scope.sampleDetails.Opportunity_Close_Date__c!=undefined && $scope.sampleDetails.Opportunity_Close_Date__c!=''){
                    year = $scope.sampleDetails.Opportunity_Close_Date__c.getUTCFullYear();
                    month = $scope.sampleDetails.Opportunity_Close_Date__c.getUTCMonth()+1;
                    day = $scope.sampleDetails.Opportunity_Close_Date__c.getDate();
                }
                $scope.detailrec = {"Sample_Name__c":$scope.sampleDetails.Sample_Name__c,"Customer_Name__c":$scope.sampleDetails.Customer_Name__c,
                                    "Annual_Volume_in_units__c":$scope.sampleDetails.Annual_Volume_in_units__c,"End_Use_category__c":$scope.sampleDetails.End_Use_category__c,
                                    "Id":$scope.sampleDetails.Id,"Sample_Requested_by__c":$scope.sampleDetails.Sample_Requested_by__c,
                                    "Main_reason_for_selecting_product__c":$scope.sampleDetails.Main_reason_for_selecting_product__c,
                                    "Annual_Volume_Full__c":$scope.sampleDetails.Annual_Volume_Full__c};
                OperationsPortalController.SaveSampleDetails($scope.detailrec,year,month,day,function(result,event){
                    debugger;
                    if(event.status && result){
                        swal("success", "Sample Details have been update successfully.","success");   
                    }
                    $scope.$apply();
                })
            }
        })
        
        .directive('soDropdown', ['$timeout', function($timeout) {
            return {
                restrict: 'E',
                require: 'ngModel',
                replace: true,
                transclude: true,
                template: function (el, atts) {
                    var itemName = 'dropdownItem';
                    var valueField = itemName + '.' + (atts.valueField || 'Id');
                    var textField = itemName + '.' + (atts.textField || 'Name');
                    return "<select class='ui search dropdown'>" +
                        "<div ng-transclude></div>" +
                        "   <option value='{{" + valueField + "}}' ng-repeat='" + itemName + " in " + atts.dropdownItems + " track by " + valueField + "'>" +
                        "       {{" + textField + "}}" +
                        "   </option>" +
                        "</select>";
                },
                link: function (scope, el, atts, ngModel) {
                    $(el).dropdown({
                        onChange: function (value, text, choice) {
                            scope.$apply(function () {
                                ngModel.$setViewValue(value);
                            });
                        }
                    });
                    ngModel.$render = function () {
                        console.log('set value', el, ngModel, ngModel.$viewValue);
                        $timeout(function () {
                            $(el).dropdown('set value', ngModel.$viewValue);
                        });
                        // $(el).dropdown('set value', ngModel.$viewValue);
                    };
                }
            };
        }]);
        </script>
        
        
        <div class="modal text-center" id="compContainer">
            <div class="modal-dialog" style="min-width:1000px">
                <div class="modal-content">
                    <div id="compContainer2">                                           
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12 text-center mx-auto">
                             <button type="button" data-bs-dismiss="modal"  onclick="cancelLWC()" class="blue-btn btn-sm">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
        function loadComponents(){
            debugger;
            alert('hi there')
            var myModal = new bootstrap.Modal(document.getElementById('compContainer'));
            myModal.show('slow');
            $Lightning.use("c:submitForFertCodeApp", function() {
                $Lightning.createComponent("c:submitForFertCode",{
                    recordId:parentId,
                },"compContainer2",function(cmp) {});
            });
        }
         function cancelLWC(){
                var myModal =document.getElementById('compContainer2');
             	myModal.innerHTML = "";
                myModal.hide('slow');
             	location.reload();
            }
            
     </script>
    </html>
</apex:page>